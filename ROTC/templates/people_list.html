{% extends 'base.html' %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>인원 관리</h2>
    </div>

    <!-- Add Person Form -->
    <!-- Add Person Form (Admin Only) -->
    {% if current_user.role == 'admin' %}
    <form action="{{ url_for('people_list') }}" method="POST" style="display: flex; gap: 10px; margin-bottom: 30px;">
        <input type="text" name="name" placeholder="이름 입력" required
            style="padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; flex-grow: 1;">
        <button type="submit" class="btn btn-primary">추가</button>
    </form>
    {% endif %}

    <!-- People List -->
    <table class="roster-table" style="text-align: left;">
        <thead>
            <tr>
                <th>이름</th>
                <th>상태</th>
                <th>작업</th>
            </tr>
        </thead>
        <tbody>
            {% for person in people %}
            <tr>
                <td>
                    {% if current_user.role == 'admin' or current_user.id == person.id %}
                    <form action="{{ url_for('edit_person', id=person.id) }}" method="POST" style="display: inline;">
                        <input type="text" name="name" value="{{ person.name }}"
                            style="border: none; background: transparent; font-size: 1rem;">
                    </form>
                    {% else %}
                    <span style="font-size: 1rem;">{{ person.name }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if person.is_active %}
                    <span style="color: var(--success); font-weight: bold;">투입 가능</span>
                    {% else %}
                    <span style="color: var(--text-muted);">제외됨</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 5px;">
                        {% if current_user.role == 'admin' %}
                        <form action="{{ url_for('toggle_person', id=person.id) }}" method="POST"
                            style="display: inline;">
                            <button type="submit" class="btn" style="background: #e2e8f0; font-size: 0.8rem;">
                                {{ '제외하기' if person.is_active else '투입하기' }}
                            </button>
                        </form>
                        {% endif %}

                        <a href="{{ url_for('person_availability', id=person.id) }}" class="btn btn-primary"
                            style="font-size: 0.8rem;">가능 시간</a>

                        {% if current_user.role == 'admin' %}
                        <form action="{{ url_for('delete_person', id=person.id) }}" method="POST"
                            style="display: inline;" onsubmit="return confirm('정말 삭제하시겠습니까?');">
                            <button type="submit" class="btn btn-danger" style="font-size: 0.8rem;">삭제</button>
                        </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}