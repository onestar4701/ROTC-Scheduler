{% extends 'base.html' %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>관리자: 사용자 관리</h2>
        <a href="{{ url_for('people_list') }}" class="btn btn-secondary">인원 목록으로 돌아가기</a>
    </div>

    <table class="roster-table" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                <th style="padding: 10px; text-align: left;">ID</th>
                <th style="padding: 10px; text-align: left;">이름</th>
                <th style="padding: 10px; text-align: left;">Username</th>
                <th style="padding: 10px; text-align: left;">Role</th>
                <th style="padding: 10px; text-align: left;">비밀번호 변경</th>
                <th style="padding: 10px; text-align: left;">관리</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 10px;">{{ user.id }}</td>
                <td style="padding: 10px; font-weight: bold;">
                    <form action="{{ url_for('admin_update_user', id=user.id) }}" method="POST"
                        style="display: flex; gap: 5px; align-items: center;">
                        <input type="text" name="name" value="{{ user.name }}" required
                            style="padding: 4px; border: 1px solid #cbd5e1; border-radius: 4px; width: 80px; font-weight: bold;">
                        <button type="submit" class="btn btn-secondary"
                            style="font-size: 0.8rem; padding: 2px 6px;">수정</button>
                    </form>
                </td>
                <td style="padding: 10px;">
                    <form action="{{ url_for('admin_update_user', id=user.id) }}" method="POST"
                        style="display: flex; gap: 5px; align-items: center;">
                        <input type="text" name="username" value="{{ user.username }}" required
                            style="padding: 4px; border: 1px solid #cbd5e1; border-radius: 4px; width: 100px;">
                        <button type="submit" class="btn btn-secondary"
                            style="font-size: 0.8rem; padding: 2px 6px;">수정</button>
                    </form>
                </td>
                <td style="padding: 10px;">
                    <form action="{{ url_for('admin_update_user', id=user.id) }}" method="POST"
                        style="display: flex; gap: 5px; align-items: center;">
                        <input type="hidden" name="update_type" value="role">
                        <select name="role" onchange="this.form.submit()"
                            style="padding: 4px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 0.8rem; background: {{ 'white' if user.role != 'admin' else '#fef2f2' }}; color: {{ 'black' if user.role != 'admin' else 'red' }}; font-weight: {{ 'normal' if user.role != 'admin' else 'bold' }};">
                            <option value="user" {{ 'selected' if user.role=='user' }}>일반 유저</option>
                            <option value="admin" {{ 'selected' if user.role=='admin' }}>관리자</option>
                        </select>
                    </form>
                </td>
                <td style="padding: 10px;">
                    <form action="{{ url_for('admin_reset_password', id=user.id) }}" method="POST"
                        style="display: flex; gap: 5px;">
                        <input type="password" name="new_password" placeholder="새 비밀번호" required
                            style="padding: 4px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 0.8rem;">
                        <button type="submit" class="btn btn-secondary"
                            style="font-size: 0.8rem; padding: 4px 8px;">변경</button>
                    </form>
                </td>
                <td style="padding: 10px;">
                    <form action="{{ url_for('delete_person', id=user.id) }}" method="POST"
                        onsubmit="return confirm('정말 삭제하시겠습니까?');">
                        <button type="submit" class="btn btn-secondary"
                            style="background: #ef4444; color: white; border: none; font-size: 0.8rem; padding: 4px 8px;">삭제</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}